<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User guides &mdash; Vault-doc  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using Secret management service via Vault&#39;s GUI and client" href="usage.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/vault-logo-small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisite">Prerequisite</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quickstart">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="#secret-values-from-small-text-files">Secret values from small text files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#encrypted-secrets">Encrypted secrets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#export-and-import-secrets">Export and import secrets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Using Secret management service via Vault's GUI and client</a></li>
<li class="toctree-l1"><a class="reference internal" href="design.html">Service design and implementation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Vault-doc</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>User guides</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/fedcloud-eu/vault-doc/blob/master/docs/quickstart.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="user-guides">
<h1>User guides<a class="headerlink" href="#user-guides" title="Permalink to this heading"></a></h1>
<p>Secret management service is implemented on the base of Hashicorp’s Vault which has web-based GUI and is supported by
many client tools and libraries. However, using Secret management service via FedCloud client is strongly recommended
as the client is tightly integrated with the service, it works out of the box without additional configuration,
has simple syntax and also advanced features like encrypted secrets.</p>
<section id="prerequisite">
<h2>Prerequisite<a class="headerlink" href="#prerequisite" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>The latest version of FedCloud client (1.2.18 and higher) is installed. If not, install or upgrade the client:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip3 install -U fedcloudclient
</pre></div>
</div>
<ul class="simple">
<li><p>Valid access token from EGI Check-in for authentication, either from
<a class="reference external" href="https://aai.egi.eu/token">EGI Check-in Token Portal</a>
or <a class="reference external" href="https://indigo-dc.gitbook.io/oidc-agent/">oidc-agent</a>, is set to environment variable:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">OIDC_ACCESS_TOKEN</span><span class="o">=</span>&lt;ACCESS_TOKEN&gt;
</pre></div>
</div>
</section>
<section id="quickstart">
<h2>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this heading"></a></h2>
<p>As FedCloud client is tightly integrated with Secret management service, no additional setting is required. Users can
access the service immediately with simple commands:</p>
<ul class="simple">
<li><p>Create a secret <code class="docutils literal notranslate"><span class="pre">my_app_secrets</span></code> in Secret management service, store MySQL and admin passwords in the secret:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fedcloud secret put my_app_secrets <span class="nv">mysql_password</span><span class="o">=</span><span class="m">123456</span> <span class="nv">admin_password</span><span class="o">=</span>abcdef
</pre></div>
</div>
<ul class="simple">
<li><p>List secrets stored in Secret management service:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fedcloud secret list
my_app_secrets
</pre></div>
</div>
<ul class="simple">
<li><p>Get a secret from Secret management service. If a key is given, the client will print only the secret value stored
in the key (useful for scripting), otherwise it will print the table of all key:value pairs.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fedcloud secret get my_app_secrets
key             value
--------------  -------
admin_password  abcdef
mysql_password  <span class="m">123456</span>


$ fedcloud secret get my_app_secrets mysql_password
<span class="m">123456</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Delete a secret from Secret management service.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fedcloud secret delete my_app_secrets
</pre></div>
</div>
</section>
<section id="secret-values-from-small-text-files">
<h2>Secret values from small text files<a class="headerlink" href="#secret-values-from-small-text-files" title="Permalink to this heading"></a></h2>
<p>If the value string is started with &quot;&#64;&quot;, the FedCloud client will read the content of the file with the name for the
value of the key. The following command creates a secret <code class="docutils literal notranslate"><span class="pre">certificate</span></code> in Secret management service for storing
host certificate and its key:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fedcloud secret put certificate <span class="nv">cert</span><span class="o">=</span>@hostcert.pem <span class="nv">key</span><span class="o">=</span>@hostkey.pem
</pre></div>
</div>
<p>Users can get the certificate latter on the target VM as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fedcloud secret get certificate cert &gt; hostcert.pem
$ fedcloud secret get certificate key  &gt; hostkey.pem
</pre></div>
</div>
<p>So far, only text files are supported. For binary files, it is recommended to use <code class="docutils literal notranslate"><span class="pre">uuencode</span></code> command for encoding
the files as texts before uploading and <code class="docutils literal notranslate"><span class="pre">uudecode</span></code> for converting the content back to the original format.</p>
<p>The limit of the secret size is 512kB, it is sufficient for storing tokens, certificates, configuration files and
so on. For larger datasets, please use permanent cloud storages.</p>
</section>
<section id="encrypted-secrets">
<h2>Encrypted secrets<a class="headerlink" href="#encrypted-secrets" title="Permalink to this heading"></a></h2>
<p>For highly-sensitive secrets, users can choose to encrypt the secret values before uploading it to the service. The
encryption is done automatically on the fly if an encryption key (passphrase) is provided:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fedcloud secret put certificate <span class="nv">cert</span><span class="o">=</span>@hostcert.pem <span class="nv">key</span><span class="o">=</span>@hostkey.pem --encrypt-key my-pass-phrase
</pre></div>
</div>
<p>Decryption is done in a similar way, just by providing decryption key, the secret value will be decrypted
automatically if the key is correct:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fedcloud secret get certificate cert --decrypt-key my-pass-phrase
</pre></div>
</div>
<p>Users can verify what is stored in the Vault by reading the secrets without providing decryption key.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fedcloud secret get certificate cert
gAAAAAB...............................
</pre></div>
</div>
<p>The encryption is done by standard Python crytography library. Security experts are invited to review the code
(available at <a class="reference external" href="https://github.com/tdviet/fedcloudclient/blob/master/fedcloudclient/secret.py#L124">GitHub</a>)
and give feedback and suggestions for improvements if possible.</p>
</section>
<section id="export-and-import-secrets">
<h2>Export and import secrets<a class="headerlink" href="#export-and-import-secrets" title="Permalink to this heading"></a></h2>
<p>Users can print secrets to files YAML/JSON format for further processing by option <code class="docutils literal notranslate"><span class="pre">--output-format</span></code> or simply <code class="docutils literal notranslate"><span class="pre">-f</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ fedcloud secret get my_app_secrets -f json

$ fedcloud secret get my_app_secrets -f yaml &gt; my_app_secrets.yaml
</pre></div>
</div>
<p>The secrets in YAML/JSON files can be imported back to the service by adding &quot;&#64;&quot; before filenames as parameters,
telling client to read secrets from files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fedcloud secret put my_second_app_secrets @my_app_secrets.yaml
</pre></div>
</div>
<p>Note the difference in examples: <code class="docutils literal notranslate"><span class="pre">cert=&#64;hostcert.pem</span></code> for reading the content of the file <code class="docutils literal notranslate"><span class="pre">horstcert.pem</span></code> as the
value for the key <code class="docutils literal notranslate"><span class="pre">cert</span></code>, and <code class="docutils literal notranslate"><span class="pre">&#64;my_app_secrets.yaml</span></code> for reading whole key:value pairs from the YAML file.</p>
<p>As YAML format is simpler, it is expected by default unless the filename has <code class="docutils literal notranslate"><span class="pre">.json</span></code> extension. Try to export your
secrets to both formats to see the differences between formats.</p>
<p>Importing secrets in files in free text format &quot;key=value&quot; is not supported as the format is error-prone, especially
for multi-line secret values or values with special characters. Users can replace <code class="docutils literal notranslate"><span class="pre">=</span></code> to <code class="docutils literal notranslate"><span class="pre">:</span></code> for converting simple
free text files to YAML format. Note that a blank space after <code class="docutils literal notranslate"><span class="pre">:</span></code> is required by YAML syntax.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="intro.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="usage.html" class="btn btn-neutral float-right" title="Using Secret management service via Vault&#39;s GUI and client" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Viet Tran.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>